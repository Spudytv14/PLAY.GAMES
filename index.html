<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spudy Games - Premium Arcade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap');
        
        body { margin: 0; overflow-x: hidden; color: white; font-family: 'Outfit', sans-serif; background-color: #050505; }
        #bg-video { position: fixed; top: 50%; left: 50%; min-width: 100%; min-height: 100%; width: auto; height: auto; transform: translateX(-50%) translateY(-50%); z-index: -3; object-fit: cover; opacity: 0.4; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(10,10,30,0.8), #000); z-index: -2; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .premium-text {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .btn-gold {
            background: linear-gradient(45deg, #d4af37, #f1c40f);
            color: black;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-gold:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .locked-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .glass-card:not(.unlocked) .locked-overlay {
            opacity: 1;
        }
        .glass-card.unlocked .locked-overlay {
            display: none;
        }

    </style>
</head>
<body>

    <!-- Background -->
    <video autoplay muted loop playsinline id="bg-video">
        <source src="https://cdn.coverr.co/videos/coverr-neon-gaming-setup-5831/1080p.mp4" type="video/mp4">
    </video>
    <div class="overlay"></div>

    <!-- Nav -->
    <nav class="fixed top-0 w-full z-50 bg-black/80 backdrop-blur-md border-b border-white/10">
        <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
            <h1 class="text-3xl font-black tracking-tighter"><span class="text-yellow-500">SPUDY</span> GAMES</h1>
            <div class="hidden md:flex gap-6 text-sm font-medium uppercase tracking-widest text-gray-300">
                <a href="#home" class="hover:text-yellow-400 transition">Home</a>
                <a href="#games" class="hover:text-yellow-400 transition">Collection</a>
                <a href="#pricing" class="hover:text-yellow-400 transition">Premium</a>
            </div>
            <button id="authBtn" onclick="openLogin()" class="btn-gold px-6 py-2 rounded-full text-sm">Login</button>
        </div>
    </nav>

    <!-- Hero -->
    <section id="home" class="min-h-[80vh] flex flex-col justify-center items-center text-center px-4 pt-20">
        <h2 class="text-sm font-bold tracking-[0.3em] text-yellow-500 mb-4 animate-pulse">NEXT GEN GAMING</h2>
        <h1 class="text-6xl md:text-8xl font-black mb-6 leading-tight">PLAY THE <br><span class="premium-text">EXTRAORDINARY</span></h1>
        <p class="text-gray-400 text-lg md:text-xl max-w-2xl mb-10">Experience our curated collection of premium games. Dive into beloved classics and new favorites.</p>
        <div class="flex gap-4">
            <button onclick="document.getElementById('free-games').scrollIntoView({behavior:'smooth'})" class="px-8 py-3 rounded-full border border-white/30 hover:bg-white/10 transition font-bold">Free Games</button>
            <button onclick="document.getElementById('pricing').scrollIntoView({behavior:'smooth'})" class="btn-gold px-8 py-3 rounded-full shadow-lg">Go Premium</button>
        </div>
    </section>

    <!-- Games Section -->
    <section id="games" class="py-20 px-4 max-w-7xl mx-auto">
        
        <!-- Free Games -->
        <div id="free-games" class="mb-20">
            <h3 class="text-3xl font-bold mb-8 border-l-4 border-green-500 pl-4">Free Access</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Math Quiz -->
                <div class="glass-card p-8 rounded-2xl relative overflow-hidden group unlocked">
                    <div class="absolute top-0 right-0 bg-green-500 text-black text-xs font-bold px-3 py-1 rounded-bl-lg">FREE</div>
                    <div class="flex items-center gap-6">
                        <div class="h-16 w-16 bg-green-500/20 rounded-full flex items-center justify-center text-green-400 text-3xl">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold">Math Quiz Master</h4>
                            <p class="text-gray-400 text-sm">Test your calculation skills.</p>
                        </div>
                    </div>
                    <button onclick="startMathQuiz()" class="mt-6 w-full py-3 rounded-xl bg-green-600 hover:bg-green-500 transition font-bold">Play Now</button>
                </div>

                <!-- Typing Speed -->
                <div class="glass-card p-8 rounded-2xl relative overflow-hidden group unlocked">
                    <div class="absolute top-0 right-0 bg-green-500 text-black text-xs font-bold px-3 py-1 rounded-bl-lg">FREE</div>
                    <div class="flex items-center gap-6">
                        <div class="h-16 w-16 bg-blue-500/20 rounded-full flex items-center justify-center text-blue-400 text-3xl">
                            <i class="fas fa-keyboard"></i>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold">Typing Speed Pro</h4>
                            <p class="text-gray-400 text-sm">How fast can you type?</p>
                        </div>
                    </div>
                    <button onclick="startTypingSpeed()" class="mt-6 w-full py-3 rounded-xl bg-blue-600 hover:bg-blue-500 transition font-bold">Play Now</button>
                </div>
            </div>
        </div>

        <!-- Premium Games -->
        <div>
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold border-l-4 border-yellow-500 pl-4"><span class="premium-text">Premium Collection</span></h3>
                <span class="text-xs font-bold bg-yellow-500/10 text-yellow-500 px-3 py-1 rounded-full border border-yellow-500/20">LOCKED</span>
            </div>

            <!-- Container for JS injection -->
            <div id="premium-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"></div>
        </div>
    </section>

    <!-- Pricing -->
    <section id="pricing" class="py-20 px-4 bg-black/50">
        <div class="max-w-5xl mx-auto text-center">
            <h2 class="text-4xl font-bold mb-4">Unlock the <span class="premium-text">Full Experience</span></h2>
            <p class="text-gray-400 mb-12">Get instant access to all premium games including new releases.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="glass-card p-10 rounded-3xl border-t-4 border-purple-500 relative">
                    <h3 class="text-2xl font-bold mb-2">Gamer Pro</h3>
                    <div class="text-4xl font-black mb-6 text-purple-400">$2.51<span class="text-lg text-gray-500">/mo</span></div>
                    <ul class="text-left space-y-3 mb-8 text-gray-300 text-sm">
                        <li><i class="fas fa-check text-purple-500 mr-2"></i> All Premium Games</li>
                        <li><i class="fas fa-check text-purple-500 mr-2"></i> Ad-free Experience</li>
                        <li><i class="fas fa-check text-purple-500 mr-2"></i> New Games Monthly</li>
                    </ul>
                    <button onclick="openPayment('Gamer Pro', 2.51)" class="w-full py-3 bg-purple-600 hover:bg-purple-500 rounded-xl font-bold shadow-lg shadow-purple-900/50">Subscribe</button>
                </div>

                <div class="glass-card p-10 rounded-3xl border-t-4 border-yellow-500 relative transform md:-translate-y-4">
                    <div class="absolute top-0 center bg-yellow-500 text-black text-xs font-bold px-3 py-1 rounded-b-lg left-1/2 -translate-x-1/2">BEST VALUE</div>
                    <h3 class="text-2xl font-bold mb-2 text-yellow-100">Lifetime Legend</h3>
                    <div class="text-4xl font-black mb-6 text-yellow-400">$49<span class="text-lg text-gray-500">/once</span></div>
                    <ul class="text-left space-y-3 mb-8 text-gray-300 text-sm">
                        <li><i class="fas fa-star text-yellow-500 mr-2"></i> Lifetime Access</li>
                        <li><i class="fas fa-star text-yellow-500 mr-2"></i> Exclusive Founder Badge</li>
                        <li><i class="fas fa-star text-yellow-500 mr-2"></i> Early Access to Betas</li>
                    </ul>
                    <button onclick="openPayment('Lifetime Legend', 49)" class="w-full py-3 btn-gold rounded-xl font-bold shadow-lg shadow-yellow-900/50">Get Lifetime Access</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 border-t border-white/10 bg-black text-center">
        <h4 class="text-2xl font-bold mb-8">Spudy Games</h4>
        <div class="flex justify-center gap-8 text-2xl mb-8">
            <a href="https://api.whatsapp.com/send?phone=263776998296" class="text-green-500 hover:scale-110 transition"><i class="fab fa-whatsapp"></i></a>
            <a href="mailto:spudytv14@gmail.com" class="text-blue-400 hover:scale-110 transition"><i class="fas fa-envelope"></i></a>
            <a href="#" class="text-blue-600 hover:scale-110 transition"><i class="fab fa-facebook"></i></a>
            <a href="#" class="text-white hover:scale-110 transition"><i class="fab fa-x-twitter"></i></a>
        </div>
        <p class="text-gray-500 text-sm">© 2026 Spudy Games. Created by Matipaishe.</p>
    </footer>

    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center hidden z-[60]">
        <div class="glass-card p-8 rounded-3xl max-w-lg w-full text-center relative mx-4">
            <button onclick="closePayment()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-2xl"></i></button>
            <h2 class="text-3xl font-bold mb-2" id="planName">Gamer Pro</h2>
            <p class="text-4xl font-black text-yellow-500 mb-8" id="planPrice">$2.51</p>
            
            <div class="bg-white/5 p-4 rounded-xl mb-6">
                <p class="text-sm text-gray-400 mb-2">Send payment via EcoCash to:</p>
                <p class="text-2xl font-mono font-bold text-white tracking-wider select-all">0776998296</p>
                <p class="text-xs text-green-400 mt-1"><i class="fas fa-check-circle"></i> Matipaishe</p>
            </div>

            <p class="mb-4 text-sm text-gray-300">Choose method to confirm:</p>
            <div class="grid grid-cols-3 gap-4">
                <button onclick="pay('EcoCash')" class="p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-blue-900 transition flex flex-col items-center gap-2">
                    <i class="fas fa-wallet text-2xl text-blue-400"></i>
                    <span class="text-xs font-bold">EcoCash</span>
                </button>
                <button onclick="pay('OneMoney')" class="p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-orange-900 transition flex flex-col items-center gap-2">
                    <i class="fas fa-mobile-alt text-2xl text-orange-400"></i>
                    <span class="text-xs font-bold">OneMoney</span>
                </button>
                <button onclick="pay('NetOne')" class="p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-red-900 transition flex flex-col items-center gap-2">
                    <i class="fas fa-sim-card text-2xl text-red-400"></i>
                    <span class="text-xs font-bold">NetOne</span>
                </button>
            </div>
            <p class="mt-6 text-xs text-gray-500">Clicking a method will open WhatsApp to confirm your payment.</p>
        </div>
    </div>

    <!-- Math Quiz Modal -->
    <div id="mathGameModal" class="fixed inset-0 bg-black/95 backdrop-blur-xl flex items-center justify-center hidden z-[70]">
        <div class="glass-card p-6 md:p-8 rounded-3xl max-w-2xl w-full mx-4 flex flex-col items-center text-center relative">
            <button onclick="closeMathGame()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-2xl"></i></button>

            <!-- Game Header -->
            <div class="flex justify-between w-full mb-8">
                <div class="text-left">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Score</p>
                    <p class="text-2xl font-bold text-green-400" id="math-score">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Level</p>
                    <p class="text-2xl font-bold text-blue-400" id="math-level">1</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Time</p>
                    <p class="text-2xl font-bold text-yellow-500" id="math-timer">60s</p>
                </div>
            </div>

            <!-- Question -->
            <div id="math-game-view" class="w-full">
                <div class="mb-10 py-10">
                    <span id="math-question" class="text-5xl md:text-7xl font-black text-white tracking-tight"></span>
                </div>

                <!-- Options -->
                <div class="grid grid-cols-2 gap-4 w-full" id="math-options">
                    <!-- Buttons injected via JS -->
                </div>
            </div>

            <!-- Game Over View -->
            <div id="math-game-over" class="hidden w-full">
                <h3 class="text-3xl font-bold mb-2">Time's Up!</h3>
                <p class="text-gray-400 mb-8">Your calculation skills result:</p>

                <div class="text-6xl font-black text-green-500 mb-2" id="math-final-score">0</div>
                <p class="text-sm uppercase tracking-widest text-gray-500 mb-10">Total Score</p>

                <button onclick="startMathQuiz()" class="w-full py-4 rounded-xl bg-green-600 hover:bg-green-500 transition font-bold text-lg mb-4">Play Again</button>
                <button onclick="closeMathGame()" class="w-full py-4 rounded-xl bg-white/10 hover:bg-white/20 transition font-bold text-lg">Exit</button>
            </div>
        </div>
    </div>

    <!-- Typing Speed Modal -->
    <div id="typingGameModal" class="fixed inset-0 bg-black/95 backdrop-blur-xl flex items-center justify-center hidden z-[70]">
        <div class="glass-card p-6 md:p-8 rounded-3xl max-w-3xl w-full mx-4 flex flex-col items-center relative">
            <button onclick="closeTypingGame()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-2xl"></i></button>

            <!-- Game Header -->
            <div class="flex justify-between w-full mb-6">
                <div class="text-left">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">WPM</p>
                    <p class="text-2xl font-bold text-blue-400" id="typing-wpm">0</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Time</p>
                    <p class="text-2xl font-bold text-yellow-500" id="typing-timer">60s</p>
                </div>
            </div>

            <!-- Game View -->
            <div id="typing-game-view" class="w-full">
                <div class="bg-black/30 p-6 rounded-xl mb-6 text-left min-h-[150px] relative">
                    <p id="typing-text" class="text-xl md:text-2xl font-mono leading-relaxed text-gray-500 select-none"></p>
                    <textarea id="typing-input" class="absolute inset-0 w-full h-full opacity-0 cursor-text" spellcheck="false" autocomplete="off"></textarea>
                </div>
                <p class="text-sm text-gray-400 text-center">Click text to focus. Start typing to begin.</p>
            </div>

            <!-- Game Over View -->
            <div id="typing-game-over" class="hidden w-full text-center">
                <h3 class="text-3xl font-bold mb-2">Test Complete!</h3>
                <p class="text-gray-400 mb-8">Your typing speed result:</p>

                <div class="grid grid-cols-2 gap-4 mb-10">
                    <div class="bg-white/5 p-4 rounded-xl">
                        <div class="text-4xl font-black text-blue-500 mb-1" id="typing-final-wpm">0</div>
                        <p class="text-xs uppercase tracking-widest text-gray-500">WPM</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-xl">
                        <div class="text-4xl font-black text-purple-500 mb-1" id="typing-accuracy">0%</div>
                        <p class="text-xs uppercase tracking-widest text-gray-500">Accuracy</p>
                    </div>
                </div>

                <button onclick="startTypingSpeed()" class="w-full py-4 rounded-xl bg-blue-600 hover:bg-blue-500 transition font-bold text-lg mb-4">Try Again</button>
                <button onclick="closeTypingGame()" class="w-full py-4 rounded-xl bg-white/10 hover:bg-white/20 transition font-bold text-lg">Exit</button>
            </div>
        </div>
    </div>

    <script>
        // Game Logic Stubs
        const games = [
            { name: "Spelling Bee", id: "startSpellingBee", icon: "fa-spell-check", color: "purple", colorClass: "text-purple-400", bgClass: "bg-purple-500/20" },
            { name: "Flag Quiz", id: "startFlagQuiz", icon: "fa-flag", color: "red", colorClass: "text-red-400", bgClass: "bg-red-500/20" },
            { name: "Color Mixing", id: "startColorMixing", icon: "fa-palette", color: "yellow", colorClass: "text-yellow-400", bgClass: "bg-yellow-500/20" },
            { name: "Logic Puzzle", id: "startLogicPuzzle", icon: "fa-puzzle-piece", color: "cyan", colorClass: "text-cyan-400", bgClass: "bg-cyan-500/20" },
            { name: "Cryptography", id: "startCryptography", icon: "fa-key", color: "orange", colorClass: "text-orange-400", bgClass: "bg-orange-500/20" },
            { name: "Memory Matrix", id: "startMemoryMatrix", icon: "fa-brain", color: "pink", colorClass: "text-pink-400", bgClass: "bg-pink-500/20" },
            { name: "Spudy Snake", id: "startSnake", icon: "fa-dragon", color: "indigo", colorClass: "text-indigo-400", bgClass: "bg-indigo-500/20" },
            { name: "Tic Tac Toe AI", id: "startTicTacToe", icon: "fa-times", color: "teal", colorClass: "text-teal-400", bgClass: "bg-teal-500/20", new: true },
            { name: "Word Search", id: "startWordSearch", icon: "fa-search", color: "lime", colorClass: "text-lime-400", bgClass: "bg-lime-500/20" },
            { name: "2048 Spudy", id: "start2048", icon: "fa-th", color: "rose", colorClass: "text-rose-400", bgClass: "bg-rose-500/20", new: true },
            { name: "Sudoku Master", id: "startSudoku", icon: "fa-border-all", color: "emerald", colorClass: "text-emerald-400", bgClass: "bg-emerald-500/20" },
            { name: "Hangman", id: "startHangman", icon: "fa-user-injured", color: "amber", colorClass: "text-amber-400", bgClass: "bg-amber-500/20" },
            { name: "Connect Four", id: "startConnectFour", icon: "fa-circle", color: "violet", colorClass: "text-violet-400", bgClass: "bg-violet-500/20" },
            { name: "Spudy Racer", id: "startRacer", icon: "fa-car", color: "sky", colorClass: "text-sky-400", bgClass: "bg-sky-500/20", new: true },
            { name: "Chess Master", id: "startChess", icon: "fa-chess-knight", color: "white", colorClass: "text-white", bgClass: "bg-white/20", new: true },
            { name: "Space Invaders", id: "startSpace", icon: "fa-rocket", color: "red", colorClass: "text-red-500", bgClass: "bg-red-500/20", new: true },
            { name: "Cyber Poker", id: "startPoker", icon: "fa-dice", color: "purple", colorClass: "text-purple-400", bgClass: "bg-purple-500/20", new: true },
        ];

        const premiumGrid = document.getElementById('premium-grid');
        
        games.forEach(game => {
            const card = document.createElement('div');
            card.className = `glass-card p-6 rounded-xl relative overflow-hidden group`;
            card.innerHTML = `
                ${game.new ? '<div class="absolute top-0 right-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 rounded-bl-lg z-10">NEW</div>' : ''}
                <div class="flex flex-col items-center text-center gap-4">
                    <div class="h-12 w-12 ${game.bgClass} rounded-full flex items-center justify-center ${game.colorClass} text-2xl">
                        <i class="fas ${game.icon}"></i>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold leading-tight mb-1">${game.name}</h4>
                    </div>
                </div>
                <button onclick="checkLogin('${game.id}', '${game.name}')" class="mt-4 w-full py-2 rounded-lg bg-white/10 hover:bg-white/20 transition text-sm font-bold border border-white/10">Play</button>
                
                <!-- Lock Overlay -->
                <div class="locked-overlay" onclick="checkLogin('${game.id}', '${game.name}')">
                    <i class="fas fa-lock text-3xl text-yellow-500 mb-2"></i>
                    <span class="text-xs font-bold uppercase tracking-widest text-gray-300">Premium</span>
                </div>
            `;
            premiumGrid.appendChild(card);
        });

        // --- MATH QUIZ LOGIC ---
        let mathTimerInterval;
        let mathScore = 0;
        let mathLevel = 1;
        let mathTimeLeft = 60;
        let mathPlaying = false;

        function startMathQuiz() {
            document.getElementById('mathGameModal').classList.remove('hidden');
            document.getElementById('math-game-view').classList.remove('hidden');
            document.getElementById('math-game-over').classList.add('hidden');
            mathScore = 0;
            mathLevel = 1;
            mathTimeLeft = 60;
            mathPlaying = true;
            updateMathUI();
            generateMathQuestion();
            clearInterval(mathTimerInterval);
            mathTimerInterval = setInterval(() => {
                mathTimeLeft--;
                updateMathUI();
                if(mathTimeLeft <= 0) endMathGame();
            }, 1000);
        }

        function closeMathGame() {
            document.getElementById('mathGameModal').classList.add('hidden');
            clearInterval(mathTimerInterval);
            mathPlaying = false;
        }

        function updateMathUI() {
            document.getElementById('math-score').textContent = mathScore;
            document.getElementById('math-level').textContent = mathLevel;
            document.getElementById('math-timer').textContent = mathTimeLeft + 's';
        }

        function generateMathQuestion() {
            if(!mathPlaying) return;

            // Difficulty logic based on Level
            // Level 1-5: Simple Ops
            // Level 6-10: Medium Ops
            // Level 11+: Hard Ops

            let ops = ['+'];
            if(mathLevel > 2) ops.push('-');
            if(mathLevel > 5) ops.push('*');
            if(mathLevel > 10) ops.push('/');

            const op = ops[Math.floor(Math.random() * ops.length)];
            let a, b, ans;

            const maxNum = 10 + (mathLevel * 5); // Increase range with level

            if(op === '+') {
                a = r(1, maxNum);
                b = r(1, maxNum);
                ans = a + b;
            } else if(op === '-') {
                a = r(5, maxNum);
                b = r(1, a);
                ans = a - b;
            } else if(op === '*') {
                const maxFactor = 2 + Math.floor(mathLevel / 2);
                a = r(2, maxFactor);
                b = r(2, 12);
                ans = a * b;
            } else if(op === '/') {
                b = r(2, 10);
                ans = r(2, 10 + mathLevel);
                a = b * ans; // Ensure clean division
            }

            document.getElementById('math-question').textContent = `${a} ${op} ${b} = ?`;

            // Generate options
            let options = [ans];
            while(options.length < 4) {
                let range = 5 + Math.floor(mathLevel / 2);
                let wrong = ans + r(-range, range);
                if(wrong !== ans && wrong >= 0 && !options.includes(wrong)) options.push(wrong);
            }
            options = options.sort(() => Math.random() - 0.5);

            const container = document.getElementById('math-options');
            container.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-2xl font-bold transition";
                btn.textContent = opt;
                btn.onclick = () => checkMathAnswer(opt === ans);
                container.appendChild(btn);
            });
        }

        function checkMathAnswer(isCorrect) {
            if(isCorrect) {
                mathScore += (10 * mathLevel);
                mathLevel++; // Level up on every correct answer? Or maybe every few? Let's make it every correct answer for rapid progression as requested "levels from 1 going forward"
                // Visual feedback?
            } else {
                // Deny and move next
                const gameView = document.getElementById('math-game-view');
                gameView.classList.add('animate-pulse');
                gameView.style.borderColor = "red";
                setTimeout(() => {
                    gameView.classList.remove('animate-pulse');
                    gameView.style.borderColor = "transparent"; // Reset
                }, 200);
            }
            // Always generate new question
            generateMathQuestion();
            updateMathUI();
        }

        function endMathGame() {
            mathPlaying = false;
            clearInterval(mathTimerInterval);
            document.getElementById('math-game-view').classList.add('hidden');
            document.getElementById('math-game-over').classList.remove('hidden');
            document.getElementById('math-final-score').textContent = mathScore;
        }

        function r(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }


        // --- TYPING SPEED LOGIC ---
        let typingTimerInterval;
        let typingTimeLeft = 60;
        let typingLevel = 1;
        let typingStarted = false;
        let typingText = "";
        let totalChars = 0;
        let correctChars = 0;

        const typingTexts = [
            "cat dog run sky blue red hot sun", // Level 1
            "The quick brown fox jumps over the lazy dog.", // Level 2
            "Programming is the art of telling another human what one wants the computer to do.", // Level 3
            "Technology is best when it brings people together. It is only when they go wrong that machines remind you how powerful they are.", // Level 4
            "To be or not to be, that is the question. Whether 'tis nobler in the mind to suffer the slings and arrows of outrageous fortune.", // Level 5
            "Success is not final, failure is not fatal: It is the courage to continue that counts. Believe you can and you're halfway there.", // Level 6
            "In the middle of difficulty lies opportunity. The only way to do great work is to love what you do. Stay hungry, stay foolish." // Level 7
        ];

        function startTypingSpeed() {
            document.getElementById('typingGameModal').classList.remove('hidden');
            document.getElementById('typing-game-view').classList.remove('hidden');
            document.getElementById('typing-game-over').classList.add('hidden');

            typingTimeLeft = 60;
            typingLevel = 1;
            typingStarted = false;
            correctChars = 0;
            totalChars = 0;

            // Setup Text
            loadTypingLevel();

            const input = document.getElementById('typing-input');
            input.value = '';
            input.focus();
            input.oninput = handleTyping;

            updateTypingUI();
            clearInterval(typingTimerInterval);
        }

        function loadTypingLevel() {
            const index = Math.min(typingLevel - 1, typingTexts.length - 1);
            typingText = typingTexts[index];
            renderTypingText('');
            document.getElementById('typing-input').value = '';
        }

        function handleTyping(e) {
            if(!typingStarted) {
                typingStarted = true;
                typingTimerInterval = setInterval(() => {
                    typingTimeLeft--;
                    updateTypingUI();
                    if(typingTimeLeft <= 0) endTypingGame();
                }, 1000);
            }

            const inputVal = e.target.value;
            renderTypingText(inputVal);

            // Auto finish if complete
            if(inputVal.length >= typingText.length) {
                // Check if accuracy is good enough to proceed?
                // For now, just level up
                typingLevel++;
                loadTypingLevel();
            }
        }

        function renderTypingText(inputVal) {
            const display = document.getElementById('typing-text');
            display.innerHTML = '';
            let correctCount = 0;

            for(let i=0; i<typingText.length; i++) {
                const span = document.createElement('span');
                const char = typingText[i];
                const inputChar = inputVal[i];

                if(inputChar == null) {
                    span.textContent = char; // Not typed yet
                } else if(inputChar === char) {
                    span.textContent = char;
                    span.className = "text-green-400";
                    correctCount++;
                } else {
                    span.textContent = char;
                    span.className = "text-red-500 bg-red-900/30";
                }
                display.appendChild(span);
            }
            correctChars = correctCount;
            totalChars = inputVal.length;

            // Live WPM calculation
            if(typingTimeLeft < 60) {
                 const elapsed = 60 - typingTimeLeft;
                 const wpm = Math.round((correctChars / 5) / (elapsed / 60));
                 document.getElementById('typing-wpm').textContent = isFinite(wpm) ? wpm : 0;
            }
        }

        function updateTypingUI() {
            document.getElementById('typing-timer').textContent = typingTimeLeft + 's';
        }

        function closeTypingGame() {
             document.getElementById('typingGameModal').classList.add('hidden');
             clearInterval(typingTimerInterval);
             typingStarted = false;
        }

        function endTypingGame() {
            clearInterval(typingTimerInterval);
            document.getElementById('typing-game-view').classList.add('hidden');
            document.getElementById('typing-game-over').classList.remove('hidden');

            const elapsed = 60 - typingTimeLeft;
            const time = elapsed === 0 ? 1 : elapsed; // Avoid div by zero
            const wpm = Math.round((correctChars / 5) / (time / 60));
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 0;

            document.getElementById('typing-final-wpm').textContent = wpm;
            document.getElementById('typing-accuracy').textContent = accuracy + '%';
        }
        
        // Dynamic functions for premium games
        games.forEach(game => {
            window[game.id] = function() {
                alert(`Starting ${game.name}... (This is a premium feature!)`);
            };
        });

        // Auth & Payment Logic
        if (localStorage.getItem('spudyLoggedIn') === 'true') {
            document.getElementById('authBtn').textContent = 'Account';
            // Unlock games visually
            document.querySelectorAll('.glass-card').forEach(c => c.classList.add('unlocked'));
        }

        function openLogin() { 
            const wantLogin = confirm('Contact +263 77 699 8296 on WhatsApp for login credentials?');
            if(wantLogin) {
                 window.open('https://api.whatsapp.com/send?phone=263776998296&text=Hello, I would like to login to Spudy Games.', '_blank');
            }
        }

        function checkLogin(funcName, gameName) {
            if (localStorage.getItem('spudyLoggedIn') === 'true') {
                if (typeof window[funcName] === 'function') {
                    window[funcName]();
                }
            } else {
                // Shake effect or visual cue?
                // alert('Premium game! Please login first.');
                openPayment('Premium Access', 2.51); // Suggest upgrade immediately
            }
        }

        function openPayment(plan, price) {
            document.getElementById('planName').textContent = plan;
            document.getElementById('planPrice').textContent = price === 49 ? '$49 Lifetime' : '$' + price + (price === 2.51 ? '/month' : '');
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function pay(method) {
            // New number: 263776998296
            const msg = `I want to pay for Spudy Games ${document.getElementById('planName').textContent} using ${method}. Please send payment details for EcoCash 0776998296.`;
            window.open(`https://api.whatsapp.com/send?phone=263776998296&text=${encodeURIComponent(msg)}`, '_blank');
        }

        function closePayment() { document.getElementById('paymentModal').classList.add('hidden'); }

        new Typed('#typed', { 
            strings: ["16 Games", "2 Free • 14 Premium", "Join 15,000+ Players", "Game On!"], 
            typeSpeed: 80, loop: true 
        });
    </script>
</body>
</html>
